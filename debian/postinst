#!/bin/bash
set -e

# --- Update system MIME and desktop databases ---
update-mime-database /usr/share/mime || true
update-desktop-database /usr/share/applications || true
gtk-update-icon-cache -f /usr/share/icons/hicolor || true

# --- Register Tabliato as the default app for .dtb files ---

# For all freedesktop-compliant environments (GNOME, KDE, XFCE, Cinnamon, etc.)
if command -v gio >/dev/null 2>&1; then
    gio mime application/x-tabliato-dtb tabliato.desktop || true
else
    xdg-mime default tabliato.desktop application/x-tabliato-dtb || true
fi

# --- Force-refresh MIME cache for Cinnamon/Nemo ---
if pgrep -x "nemo" >/dev/null 2>&1; then
    nemo --quit || true
    nohup nemo >/dev/null 2>&1 &
fi

exit 0

